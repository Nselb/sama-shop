generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

enum PriceModifierOperator {
  ADD
  SUBTRACT
  PERCENTAGE_ADD
  PERCENTAGE_SUBTRACT
}

model Product {
  id               String           @id @default(uuid()) @db.Uuid
  name             String           @unique
  slug             String           @unique
  basePrice        Decimal
  images           String[]
  shortDescription String
  longDescription  String
  productVariants  ProductVariant[]
}

model ProductVariant {
  product               Product               @relation(fields: [productId], references: [id])
  productId             String
  name                  String
  priceModifier         Decimal
  priceModifierOperator PriceModifierOperator
  images                String[]
  colorCode             String?

  @@id([productId, name])
}

enum PaymentMethod {
  CARD
  TRANSFER
  CASH
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
}

model Payment {
  id        String        @id @default(uuid())
  amount    Decimal
  method    PaymentMethod
  status    PaymentStatus @default(PENDING)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  order     Order         @relation(fields: [orderId], references: [id])
  orderId   String        @db.Uuid
}

model Customer {
  id          String  @id @default(uuid())
  email       String  @unique
  firstName   String
  lastName    String
  phoneNumber String  @unique
  orders      Order[]

  @@index([email, firstName, lastName, phoneNumber])
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  COMPLETED
}

model Order {
  id          String    @id @default(uuid()) @db.Uuid
  orderNumber Int       @default(autoincrement())
  payments    Payment[]
  customer    Customer  @relation(fields: [customerId], references: [id])
  customerId  String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}
